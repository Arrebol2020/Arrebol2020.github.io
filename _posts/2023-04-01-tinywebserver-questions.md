---
layout: post
title: TinyWebServer 潜在的面试题
date: 2023-03-09 19:13 +0800
categories:
- 项目
- TinyWebServer
tags:
- C++
---



## 定时器信号

### 信号处理逻辑太复杂怎么办

Linux下的信号采用的异步处理机制，信号处理函数和当前进程是两条不同的执行路线。具体的，当进程收到信号时，操作系统会中断进程当前的正常流程，转而进入信号处理函数执行操作，完成后再返回中断的地方继续执行。

为避免信号竞态现象发生，信号处理期间系统不会再次触发它。所以，为确保该信号不被屏蔽太久，信号处理函数需要尽可能快地执行完毕。

一般的信号处理函数需要处理该信号对应的逻辑，当该逻辑比较复杂时，信号处理函数执行时间过长，会导致信号屏蔽太久。

解决方案：`信号处理函数仅仅发送信号通知程序主循环，将信号对应的处理逻辑放在程序主循环中，由主循环执行信号对应的逻辑代码`。



### 统一信号源

统一事件源，是指将信号事件与其他事件一样被处理。

具体的，信号处理函数使用管道将信号传递给主循环，信号处理函数往管道的写端写入信号值，主循环则从管道的读端读出信号值，使用 I/O 复用系统调用来监听管道读端的可读事件，这样信号事件与其他文件描述符都可以通过 epoll 来监测，从而实现统一处理。



### 为什么管道写端要非阻塞

send 是将信息发送给套接字缓冲区，如果缓冲区满了，则会阻塞，这时候会进一步增加信号处理函数的执行时间，为此，将其修改为非阻塞。



### **没有对非阻塞返回值处理，如果阻塞是不是意味着这一次定时事件失效了**

是的，但定时事件是非必须立即处理的事件，可以允许这样的情况发生。



### **管道传递的是什么类型？switch-case的变量冲突？**

信号本身是整型数值，管道中传递的是 ASCII 码表中整型数值对应的字符。

switch 的变量一般为字符或整型，当 switch 的变量为字符时，case 中可以是字符，也可以是字符对应的 ASCII 码。



### 定时容器是如何设计的

项目中的定时器容器为带头尾结点的`升序双向链表`，具体的为每个连接创建一个定时器，将其添加到链表中，并按照超时时间升序排列。执行定时任务时，将到期的定时器从链表中删除。



## 写在最后

感谢你在茫茫人海中找到我🕵🏼

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

<span id="busuanzi_container_page_pv">🎉你是第 <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i>  </span> 个读者

㊗️ 你平安喜乐，顺遂无忧！

希望你读完有所收获～

🥂🥂🥂 
